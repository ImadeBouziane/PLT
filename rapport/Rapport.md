# Rapport de Projet Logiciel Transversal "CLUEDO CONSPIRATON"

![Boitedejeu](ImagesRapport/Boitedejeu.png)

[TESTU Tristan](https://github.com/TestuTristan), [CHAIEB Ilias](https://github.com/Ilias1313), [BOUZIANE Imade](https://github.com/ImadeBouziane)

## 1. Présentation Générale 

### 1.1 Archétype

L’objectif du projet est la réalisation du jeu « Cluedo : Conspiration» Il s’agit d’un jeu de rôle  qui mêle supercherie et déduction. C’est un jeu conçu pour 4 à 10 joueurs. Les joueurs incarnent des personnages du Cluedo classique et jouent des rôles secrets dans des équipes adverses. L’équipe des Amis cherchent à sauver M. Corail et à révéler le complot des conspirateurs. L’équipe des Conspirateurs tentent secrètement de saboter les plans des Amis et de mettre à exécution le complot de meurtre.

### 1.2 Règles du jeu
Les joueurs ont été invités à l’Hôtel Resort la Vipère Noire dirigé par Carl Corail. Alors qu’une tempête se lève, les joueurs découvrent une série de pièges mortels dans l’hôtel. L’un des joueurs veut tuer Mr. Corail. Les joueurs doivent résoudre ce mystère sans savoir à qui faire confiance.
	
Une fois le jeu installé, chaque joueur choisit un personnage et se voit assigner un rôle secret. Les joueurs peuvent alors être un membre conspirateur qui veut tuer Mr. Corail ou un ami qui veut le maintenir en vie. Pendant la révélation du complot, tous les joueurs ferment les yeux sauf  les membres conspirateurs qui peuvent alors s’identifier secrètement les uns les autres et le conspirateur en chef montre les cartes lieux et armes à ses complices :  la conspiration est activé et la partie peut commencer. 

L’objectif principal des conspirateurs est d’exécuter le complot. Seul le conspirateur en chef peut tuer Mr. Corail si elle est la bonne personne , Garde du Corps de Mr . Corail , au bon endroit , lieu du complot , et au bon moment , après que Mr. Corail ait été blessé. Ils peuvent aussi tenter de tuer Mr. Corail en activant des pièges dans l’hôtel jusqu’à ce qu’il perde tous ses points de vie.

L’objectif principal des amis est de maintenir Mr. Corail en vie en désamorçant les pièges et en empêchant le complot. Mais même si Mr. Corail est tué par les pièges, les amis peuvent encore gagner en identifiant les éléments du complot : Qui est le conspirateur en chef ? Où voulait-il tuer Mr. Corail ? Et avec quelle arme ?

Le jeu se joue en rounds. A chaque round une équipe est choisie pour explorer un lieu pour désamorcer ou activer secrètement un piège. Le rôle de l'Éclaireur change à chaque round. Chaque tour, l’éclaireur choisi trois éléments : un Lieu où se rendre , un Garde du Corps ( il a la responsabilité d’escorter Mr. Corail vers le lieu et de récupérer les indices.) et les autres membres de l'équipe  qui l'accompagnent. Choisir ses accompagnants est important. Une fois le choix de l’éclaireur effectué, tous les joueurs votent pour savoir si l’équipe choisie doit se déplacer dans le lieu. La majorité l’emporte et en cas d’égalité le vote est rejeté. S’il est rejeté le traqueur de tempête avance de un (Si le traqueur de tempête vaut 3, Mr. Corail perd un Point de Vie) et le joueur de gauche devient le nouvel éclaireur. Si le vote est approuvé tous les joueurs choisi et Mr. Corail se déplace vers le lieu choisi. Une fois dans le lieu, les joueurs demandent si le complot est activé.

Une fois sur le lieu, l’équipe choisie essaye de désamorcer le piège. Chaque lieu comprend trois cartes : 1 carte piège face visible et deux cartes Indices face cachée. Pour désamorcer les pièges ont doit utiliser les cartes équipement présent dans notre main. Toutes les cartes d'équipement valent 1 ou 2. Si la valeur est deux, la carte aura aussi une couleur : soit un triangle bleu ou un cercle rose. Les pièges ont également une valeur et une couleur. La valeur sur le piège est le seuil que l’équipe choisit doit atteindre si elle veut désamorcer le piège. Les cartes équipement de même couleur que le piège s'additionnent, le désamorce et les cartes de couleurs  contraires sont soustraites.  Les joueurs ne peuvent jamais avoir plus de trois cartes d’équipements en main. Chaque joueur sur le lieu doit soumettre au moins une carte équipée face cachée à l’Eclaireur. L’Eclaireur récupère et mélange les cartes reçues puis les retourne une à une pour additionner la valeur totale des équipements. Si elle est égale ou supérieur au nombre dans le coin bas gauche du piège  Mr. Corail est sauvé pour ce round. Mais si la valeur totale est inférieur à celle du piège, Mr. Corail est blessé et devient ainsi vulnérable à la conspiration. Dans les deux cas le piège est retiré et le Garde Du Corps  récupère les cartes indices présentés sous le piège (il peut mentir au sujet des indices). Il y a quatre types d’indices : Armes , Lieux, Aucun indice et Désamorçage Instantané (peut désamorcer un piège instantanément sans que les joueurs ait à poser des cartes équipements. Ensuite après avoir annoncé (ou menti) les cartes Indices , le Garde du Corps repose face cachée les indices devant lui et prend un jeton (si il a annoncé une Arme ou un Lieu) qu’il place devant lui comme repère pour savoir qui a vu quoi.
 
La dernière étape du Round est de distribuer les cartes Équipements. L’Eclaireur pioche le nombre de cartes Equipement équivalent au nombre de pions (dont celui de Mr. Corail) puis, sans les regarder , il les distribue comme il le veut aux joueurs sur ce Lieu. Les joueurs non présents piochent également une carte Équipement (à condition qu’ils aient moins de 3 cartes). Enfin, le joueur à la gauche de l’Eclaireur devient le nouvel Éclaireur pour le tour suivant et un nouveau round commence. 

Tous les rounds se déroulent de la même façon jusqu’à ce que la partie se termine d’une des trois façon suivantes :  
Les Amis se rendent dans tous les lieux et retirent tous les pièges avant que Mr. Corail ne soit tué. => Les Amis gagnent 
Le complot est activé et Mr. Corail est assassiné => La conspiration gagne 
Mr. Corail est tué par les pièges , le jeu passe alors à l’accusation finale. Pour les Amis ,c’est la dernière chance de découvrir la conspiration. Pour les conspirateurs c’est leur dernière chance d’échapper à la justice. Le nouvel Éclaireur choisit une équipe sans Garde du Corps ni Lieu et les joueurs passent au vote pour cette dernière. Si le vote n’est pas approuvé, on vote pour la prochaine équipe créée par l’Eclaireur suivant. Une fois le vote approuvé, l’ Eclaireur récupère toutes les cartes Indices restantes, les mélange et les distribue une à une aux joueurs choisis dans l’équipe. Les joueurs retournent ensuite sur le plateau et ils ont 5 minutes pour discuter et débattre de chaque élément du complot. Qui est le conspirateur en chef ? Où avait-il prévu de tuer Mr. Corail ? Quelle arme avait-il l’intention d’utiliser ? Une fois le temps écoulé, tous les joueurs votent et la majorité l’emporte. En cas d’égalité, l’Eclaireur tranche. Une fois l’accusation faite, le conspirateur en chef se dévoile et il dévoile le lieu et l’arme. Si tout était juste les Amis gagnent sinon c’est la conspiration qui gagne !

### 1.3 Ressources

**Le plateau de jeu:**

![Plateau](ImagesRapport/Plateau.png)

**Role Secret:**

![RoleSecret](ImagesRapport/RoleSecret.png)

**Les cartes Joueurs/Identités:**

![Identités](ImagesRapport/Identités.png)

**Les cartes indices:**

![Indices](ImagesRapport/Indices.png)

Elle détermine quel joueur choisit en premier son personnage au début du tour.
### Règles du jeu
**Mise en place:**
Au début d'une partie, chaque joueur reçoit 2 pièces d'or, 4 cartes quartiers puis on attribut la couronne à un joueur aléatoirement choisi.

Une partie se décompose en tours ayant tous le même déroulement.

Déroulement d'un tour:

**I - Choix des personnages:**

Le joueur qui possède la couronne mélange les 8 cartes personnages. 3 cartes sont alors choisies aléatoirement puis écartées, 2 face visibles et 1 face cachée (le Roi ne peut pas se trouver dans les cartes face visible).
Le joueur choisit ensuite un personnage, puis il passe le paquet de cartes au joueur à sa gauche qui choisit à sont tour et ansi de suite pour les 4 joueurs. La dernière carte est donc également écartée à la fin du choix du 4ème joueur.

**II - Tours des joueurs:**

Les personnages sont appelés dans l'ordre de leur numéro. Chaque fois qu’un personnage est appelé, le joueur qui l’avait choisi révèle sa carte de personnage et joue son tour. Si aucun joueur n’avait choisi ce personnage, on appelle le personnage suivant.
Lorsque tous les joueurs ont joué, on reprend les huit cartes de personnages et on les mélange pour passer au tour suivant.
Les joueurs jouent donc à tour de rôle, non pas dans le sens horaire habituel mais dans un ordre qui dépend des cartes de personnages qu’ils ont choisies.

**Exemple:** 

Supposons que le joueur 1 à choisi le Voleur, le joueur 2 à choisi l'Architecte, le joueur 3 a choisi le Marchand et le joueur 4 a choisi le Roi.

Les personnages sont alors appelés selon leur ordre:

1-Assassin : personne ne joue

2-Voleur : Le joueur 1 joue son tour

3-Magicien: personne ne joue

4-Roi : le joueur 4 joue son tour

5-Eveque : personne ne joue

6-Marchand : le joueur 3 joue son tour

7-Architecte : le joueur 2 joue son tour

8-Condottière : personne ne joue  

‎ 

Lorsque le personnage d’un joueur est appelé, le joueur effectue les actions suivantes:

  1) Au choix: soit prendre deux pièces d'or de la banque; soit piocher deux cartes Quartier, en choisir une et se défausser de l’autre.
 
2) Il peut ensuite poser dans sa cité l’une de ses cartes Quartier en payant à la banque le coût indiqué sur la carte. Un joueur ne peut jamais avoir deux quartiers de même nom dans sa cité.
 
  3) Chacun des personnages dispose également d'un pouvoir spécial pouvant être utilisé lors de son tour de jeu. Tous les pouvoirs ne doivent pas être joué nécessairement au même moment du tour (précisé par la suite). 

Les pouvoirs des personnages :
  
**1-Assassin**

Vous annoncez quel autre personnage vous assassinez. Le joueur qui a ce personnage ne doit pas réagir, et ne se déclarera pas non plus lorsque son personnage sera appelé. Il ne révèlera sa carte qu’en dernier, pour annoncer qu’il avait été assassiné et qu’il a donc passé son tour.

**2-Voleur**

Vous annoncez quel autre personnage vous volez. Lorsque le joueur qui a ce personnage sera appelé et se révèlera, vous lui prendrez toutes ses pièces d’or. Le Voleur ne peut voler ni l’**Assassin**, ni le personnage assassiné.

**3-Magicien**

À n’importe quel moment de votre tour*, vous pouvez, au choix :
• soit échanger toutes les cartes de votre main contre toutes les cartes de la main d’un autre joueur.
• soit vous défausser d’un certain nombre de cartes de votre main et piocher le même nombre de cartes en échange.

**4-Roi**

Vous recevez une pièce d’or par quartier noble (jaune) dans votre cité*. Vous prenez immédiatement la carte Couronne. Au tour suivant, vous choisirez votre personnage en premier. Si aucun joueur n’a choisi le **Roi**, le **Roi** précédent conserve la couronne.
Si le **Roi** est assassiné, il passe son tour comme n’importe quel personnage. Néanmoins, après que tous les autres joueurs ont joué, lorsqu’il annonce qu’il était Roi et a été assassiné, il prend la carte couronne.

**5- Évêque**

Vous recevez une pièce d’or par quartier religieux (bleu) dans votre cité*. Vous ne pouvez pas être attaqué par le **Condottiere**.

**6-Marchand**

Vous recevez au début de votre tour une pièce d’or supplémentaire. Vous recevez une pièce d’or par quartier commerçant (vert) dans votre cité*.

**7-Architecte**

Au début de votre tour, vous piochez deux cartes Quartiers supplémentaires. Vous pouvez en outre bâtir jusqu’à trois quartiers durant votre tour.

**8-Condottiere**

Vous recevez une pièce d’or par quartier militaire (rouge) dans votre cité*. À la fin de votre tour, vous pouvez attaquer une cité pour y détruire un quartier de votre choix en payant le coût de ce quartier mooins un (ex: 1 pièce d’or pour un quartier en coûtant 2 à construire). Le **Condottiere** ne peut attaquer une cité déjà terminée, avec ses huit quartiers.

(* Ces actions peuvent être effectuées à n’importe quel moment du tour, au choix du joueur. Ainsi, un joueur peut prendre les revenus de ses quartiers avant de construire (s’il a besoin d’argent pour construire) ou après avoir construit (si le nouveau quartier lui rapporte). Tous les revenus des quartiers doivent cependant être perçus en une seule fois.


**III - Fin de partie et décompte final des points:**

Lorsqu’un joueur construit son huitième et dernier quartier, on termine le tour en cours et la partie est terminée. Chaque joueur compte ses points comme suit :
	
 1) Coût de construction total des quartiers de la cité
	
 2) +3 si la cité comprend des quartiers des cinq couleurs différentes
	
 3) +4 pour le premier joueur ayant posé son huitième quartier
	
 4) +2 pour les autres joueurs ayant huit quartiers
	
 5) Bonus lié à certaines merveilles



## Description et conception des états

### Description des états
Un état du jeu est formée par des éléments communs à tous les Players. Il est le même pour chaque joueur.
Un unique état est créer et tient toutes les données de la partie.

**2.1 Elements définissant les états**

Tous les Players ont accès à une pioche. Cette pioche est représentée par un nombre de cartes piochées. Le server se chargera de traiter cette information afin d'ajouter le nombre de cartes correspondant à la main du Player qui pioche.

Chaque joueur possède les éléments suivants.

- Un nom qui est cosmétique.
- Une playerId qui est unique et permet de différencier les joueurs au niveau de la partie.
- Un board qui est une liste de cartes représentant les bâtiments construits.
- Des pièces d'or.
- Le personnage qu'il incarne pendant ce tour, lui permettant certaines interactions.
- Une main qui correspond aux cartes en main.

Voici la liste des différents personnages que le joueur peut incarner à chaque tour :

- Assassin
- Thief
- Magician
- King
- Bishop
- Merchant
- Architect
- Warlord



Une carte est décrite par :

- Son nom
- Son coût (en pièce d'or)
- Sa couleur, voici la liste des couleurs :

	- Religious
	- Military
	- Commercial
	- Noble
	- Wonder

### Conception Logiciel

Le diagramme des classes pour les états est présenté en Figure 1, dont nous pouvons mettre en évidence.
les groupes de classes suivants :

**La classe GameState** : La classe GameState est la classe principale pour décrire l'état du jeu.  Elle est composé de toutes les données pertinentes accessible :
- Directement dans la classe.
- Via l'appel de méthodes sur les objets qui la compose.
Elle sert à regrouper tous les Players au sein d'une même classe afin de pouvoir y traiter les données propres et communes à chaque Players. 

**La classe Player** : Elle contient les données liés aux différents joueurs. C'est une classe générique pour représenter toutes les données auxquels tous les joueurs ont accès.


Nous avons utilisé les énumérations pour décrire les différents type de "GamePhase" (qui permet d'identifier les moments de la partie), "Character", "PlayerId" et de "couleur de bâtiments" car cela permet de rendre notre code plus lisible en donnant des noms significatifs aux valeurs possibles. Les énumérations limitent les valeurs possibles à celles que nous avons définies, offrant ainsi un meilleur contrôle sur les données que l'on manipule. Si on ajoute ou modifie un type de personnage ou une couleur de bâtiment, on devra simplement le faire dans l'énumération sans avoir à rechercher et à modifier chaque occurrence dans le code. 
Nous ajoutons aussi dans tous les énums une valeur par défaut qui sert pour les initialisations et neutralisations.



![StateDia](images/StateDia.png)



## Rendu: Stratégie et Conception


### Stratégie de rendu d'un état


Pour le rendu d'un état, nous créons un module dédié à l'affichage graphique à destination des utilisateurs (joueurs).
Notre statégie de rendu est classique pour une application.
En effet, nous allons "peindre" à une fréquence fixe notre écran. Nous ne cherchons pas à peindre uniquement ce qui bouge ou déplacer des éléments car les processeurs graphiques sont fait pour tavailler avec des images et repeindre systématiquement l'écran.
A ce stade, l'interface est fixe et des animations ne sont pas prévues.


Nous définissons notre écran d'abord uniquement graphiquement sous forme d'esquisse (sans échelle).

![Esquisse d'interface](images/esquisse.png)

Nous prenons ensuite le temps de définir plus précisément notre interface.
Cette étape n'est toutefois pas encore un cahier des charges mais une ligne conductrice.

**Une description plus formelle**

Nous choisissons de garder les proportions 16/9 (standard des écrans moderne) donc nous aurons une fenêtre rectangulaire.
Nous choisissons ainsi une fenêtre de 1600x900.
Une image de fond n’est pas nécessaire pour le fonctionnement du jeu mais sera présente pour des raisons esthétiques.


SFML n'ayant pas de police par défaut, nous en choisissons des cohérentes avec le style de la version physique de notre jeu.
 
La police d’écriture est [Old London](https://www.dafont.com/fr/old-london.font).
C’est notre police dite de titre car elle rend tous les textes courts.
Notre police de texte est [Garet](https://www.dafont.com/fr/garet.font).

Elles sont toutes les deux libres de droit et d’utilisation commerciale ou non.

***Les éléments visuels***

Les proportions des cartes semblent être du 11*17.
L’écran doit pouvoir tenir au moins 15 cartes sur une même ligne, nous souhaitons les afficher convenablement et avec des espaces donc nous décidons que l’écran doit pouvoir afficher 20 cartes côte à côte horizontalement.
Donc les cartes affichées le seront en 80*124.
Cette taille peut sembler faible mais elles peuvent être agrandi en passant la souris dessus.


Les logos seront en 40*40 par conséquence du choix de la taille de la carte (un peu moins d’un tiers de carte).
Les autres éléments ont une taille devant s’inscrire dans une carte.


Les boards sont simplement des formes simples. Les cartes non présentes sont affichées par des rectangles en pointillé.

Le bouton fin de tour est une forme circulaire rendue interactive.

***Les Popups***
Nous avons des affichages ponctuels qui seront utilisés dans l'application pour afficher des informations supplémentaires.
Nous en avons deux, un bouton d'aide pour afficher des informations sur l'application et un pour afficher la main d'un joueur qui prendrait tout l'écran sinon.
Enfin, le centre de l'écran est utilisé pour afficher les cartes en grand quand on passe la sourie sur une carte.


### Conception logiciel

Pour le code, les boutons n’existant pas dans SMFL, nous proposons de les créer nous même.
Nous concevons alors les éléments suivants :
- Une classe abstraite élément interactif qui contient la partie graphique de l'élément ainsi que les méthodes de base pour l'interaction.
- Une classe concrète bouton qui hérite de la précédente pour les boutons de type pioche, aide …
- Une classe concrète carte qui hérite également pour implémenter le onHoverAction() pour zoomer sur la carte.
- Il existe deux types de boutons, les boutons moteurs communiquent des informations au moteur du jeu, les boutons afficheurs qui déclenchent l’affichage.
- Une classe d'état de l'interface pour permettre de déclencher les mises à jour graphiques dues à l'interaction avec un élément interactif.
- Une classe utilitaire playerRender qui s’occupe de l’affichage des données joueurs.
- Des Enumérations pour permettre de gérer les valeurs limitées.
- Une classe principale appelée Scène qui est le point d'entrée de ce module.

![RenderDia](images/RenderDia.png)

## Règles de changement d'états et moteur de jeu
Les changements d’état ne suivent pas d’horloge globale, chaque état sera mis à jour à l’issu d'exécutions de commandes par le joueur vers l’engine ou par l’engine vers le joueur.

### Règles

**4.1 Changements extérieurs**

Les changements extérieurs sont provoqués par des commandes extérieures, comme la pression sur une touche ou un ordre provenant du réseau :

Commande pioche (DrawCommand) : pioche de cartes par un joueur après clique sur le bouton pioche.
Commande pièces (GainGoldCommand) : pioche de deux pièces par un joueur après clique sur le bouton pièces.
Commande fin du tour (EndOfTurnCommand) : fin de tour du joueur après clique sur le bouton fin du tour.
Commande de Choix de personnage (ChooseCharacterCommand): Le joueur doit choisir parmis les personnages qui lui sont proposé. Le premier joueur a 8 choix. Il choisit son personnage et discard un personnage. Le second joueur a 6 choix, le troisème en a 5 et le dernier 4.
Commande Pouvoir du personnage (UseCharacterAbilityCommand) : Le joueur utilise la capacité spéciale de son personnage.
Commande récupréation de Gold des building (ClaimBuildingGold) : La joueur (si son personnage le lui permet) peut récupérer des Golds des Batiment qu'il a posés.

**4.2 Changements autonomes**

Le jeu s'articule en 2 pahses prinipales une phase de choix de personnage (le momoent où les joueur selectionne leur personnage pour préarer leur tour) et une phase d'appel des personnages (le momment où les joueurs jouent leur tours)

StartCommand : Cette command permet d'initialiser les parametre et veiller à ce que la connexion est bien établie.
HandleChoosingCharacterPhaseCommand permet d'afficher à chaque joueur la liste des personnages qu'il peut selectionner.
HandleCallingCharcaterPhaseCommand : L'engine va appeeler les personnages dans l'ordre. Si le personnage d'un joueur est appelé alors c'est à ce joueur de jouer son tour.
ChangPhaseCommand : Une command de changemnt de phase.

### Conception logiciel

![EngineDia](images/Engine.png)

## Intelligence Artificielle

### Stratégies

### Conception logiciel


## Modularisation

### Organisation des modules

### Conception logiciel
